{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <link rel="apple-touch-icon" sizes="76x76" href="{% static 'assets/img//apple-icon.png' %}">
    <link rel="icon" type="image/png" href="{% static 'assets/img//favicon.png' %}">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title>
        McBoutique
    </title>
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no'
        name='viewport' />
    <!--     Fonts and icons     -->
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700,200" rel="stylesheet" />
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" rel="stylesheet">
    <link href="/templates/home.css" rel="stylesheet">
    <!-- CSS Files -->
    <link href="{% static 'assets/css/bootstrap.min.css' %}" rel="stylesheet" />
    <link href="{% static 'assets/css/paper-dashboard.css' %}" rel="stylesheet" />
    <!-- CSS Just for demo purpose, don't include it in your project -->
    <link href="{% static 'assets/demo/demo.css' %}" rel="stylesheet" />
</head>

<style>
    .badge.badge-success {
        border-color: #6bd098;
        background-color: #6bd098;
        max-width: 100%;
        /* overflow:hidden; */
    }

    /* .card-login{
        width: 40vw;
        justify-content: center; align-items: center;
    } */
    .text-area-styles {
        height: 40vh;
        width: 50vw;
        box-shadow: rgba(149, 157, 165, 0.2) 0px 8px 24px;
        border: #fbc658 solid 1px;

    }


    textarea {
        border: none;
        resize: none;
        outline: none;
    }
</style>

<body class="login-page">
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-absolute fixed-top navbar-transparent" style="display:flex; ">
        <div class="container">
            <div class="navbar-wrapper">
                <div class="navbar-toggle">
                    <button type="button" class="navbar-toggler">
                        <span class="navbar-toggler-bar bar1"></span>
                        <span class="navbar-toggler-bar bar2"></span>
                        <span class="navbar-toggler-bar bar3"></span>
                    </button>
                </div>
                <a class="navbar-brand" href="javascript:;">McBoutique</a>
                <div id="output"></div>
            </div>
        </div>
    </nav>
    <!-- End Navbar -->
    <div class="wrapper wrapper-full-page " ">
        <div class=" full-page section-image" filter-color="black" data-image="{% static 'assets/img/bg/bg.jpg' %}">
        <!--   you can change the color of the filter page using: data-color="blue | purple | green | orange | red | rose " -->
        <div class="content">
            <div class="container" style="margin-top: 0 !important;">
                <div class="col-lg-12 col-md-6 ml-auto mr-auto">
                    <form class="form" method="POST" action="{% url 'MULTIPRODUCT' %}">
                        {% csrf_token %}
                        <div class="card card-login" style="size: 60vw;">
                            <div class="card-header ">
                                <div class="card-header ">
                                    <h3 class="header text-center">Get Products</h3>
                                </div>
                            </div>


                            <div
                                style="display: flex; flex-direction:column; justify-content: center; align-items: center;">
                                <div class="mb-3">

                                    <textarea class="text-area-styles" id="area" cols="60" rows="20"
                                        placeholder="https://codepen.io/rafia_zafar/pen/abLxgam?editors=1011">


                                        </textarea>


                                </div>

                                <div id="output"></div>

                                <div class="row">

                                    <div class="col-md-12 text-right">
                                        {% if file %}q
                                        <a href="{{ file }}" class="btn btn-warning btn-round"
                                            style=" color: white;">Download CSV File</a>
                                        {% endif %}
                                        <!-- <a href="#" class="btn  btn-round" style= " color: white;">Download CSV File</a> -->

                                        <button type="submit" class="btn btn-warning btn-round  mb-3">Submit</button>
                                    </div>
                                </div>

                            </div>

                        </div>
                    </form>
                </div>
            </div>
        </div>
        <footer class="footer footer-black  footer-white ">
            <div class="container-fluid">
                <div class="row">
                    <div class="credits ml-auto">
                        <span class="copyright">
                            Â© 2021 Powered by <a href="https://esquall.com/" target="_blank">eSquall
                                Technologies</a>
                        </span>
                    </div>
                </div>
            </div>
        </footer>
    </div>
    </div>
    <!--   Core JS Files   -->
    <script src="{% static 'assets/js/core/jquery.min.js' %}"></script>
    <script src="{% static 'assets/js/core/popper.min.js' %}"></script>
    <script src="{% static 'assets/js/core/bootstrap.min.js' %}"></script>
    <script src="{% static 'assets/js/plugins/perfect-scrollbar.jquery.min.js' %}"></script>
    <script src="{% static 'assets/js/plugins/moment.min.js' %}"></script>
    <!--  Plugin for Switches, full documentation here: http://www.jque.re/plugins/version3/bootstrap.switch/ -->
    <script src="{% static 'assets/js/plugins/bootstrap-switch.js' %}"></script>
    <!--  Plugin for Sweet Alert -->
    <script src="{% static 'assets/js/plugins/sweetalert2.min.js' %}"></script>
    <!-- Forms Validations Plugin -->
    <script src="{% static 'assets/js/plugins/jquery.validate.min.js' %}"></script>
    <!--  Plugin for the Wizard, full documentation here: https://github.com/VinceG/twitter-bootstrap-wizard -->
    <script src="{% static 'assets/js/plugins/jquery.bootstrap-wizard.js' %}"></script>
    <!--	Plugin for Select, full documentation here: http://silviomoreto.github.io/bootstrap-select -->
    <script src="{% static 'assets/js/plugins/bootstrap-selectpicker.js' %}"></script>
    <!--  Plugin for the DateTimePicker, full documentation here: https://eonasdan.github.io/bootstrap-datetimepicker/ -->
    <script src="{% static 'assets/js/plugins/bootstrap-datetimepicker.js' %}"></script>
    <!--  DataTables.net Plugin, full documentation here: https://datatables.net/    -->
    <script src="{% static 'assets/js/plugins/jquery.dataTables.min.js' %}"></script>
    <!--	Plugin for Tags, full documentation here: https://github.com/bootstrap-tagsinput/bootstrap-tagsinputs  -->
    <script src="{% static 'assets/js/plugins/bootstrap-tagsinput.js' %}"></script>
    <!-- Plugin for Fileupload, full documentation here: http://www.jasny.net/bootstrap/javascript/#fileinput -->
    <script src="{% static 'assets/js/plugins/jasny-bootstrap.min.js' %}"></script>
    <!--  Full Calendar Plugin, full documentation here: https://github.com/fullcalendar/fullcalendar    -->
    <script src="{% static 'assets/js/plugins/fullcalendar/fullcalendar.min.js' %}"></script>
    <script src="{% static 'assets/js/plugins/fullcalendar/daygrid.min.js' %}"></script>
    <script src="{% static 'assets/js/plugins/fullcalendar/timegrid.min.js' %}"></script>
    <script src="{% static 'assets/js/plugins/fullcalendar/interaction.min.js' %}"></script>
    <!--  Plugin for the Bootstrap Table -->
    <script src="{% static 'assets/js/plugins/nouislider.min.js' %}"></script>
    <!-- Control Center for Now Ui Dashboard: parallax effects, scripts for the example pages etc -->
    <script src="{% static 'assets/js/paper-dashboard.min.js' %}" type="text/javascript"></script>
    <!-- Paper Dashboard DEMO methods, don't include it in your project! -->
    <script src="{% static 'assets/demo/demo.js' %}"></script>
    <script>
        $(document).ready(function () {
            demo.checkFullPageBackgroundImage();
        });
    </script>

    <script>
        //approach 3

//approach 1
        // area.addEventListener("paste", (e) => {
        //     let data = e.clipboardData.getData("text");
        //     let dataArray = data.split("");
        //     var expression = /[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)?/gi;
        //     var rlet myresult;
let i = 1;
var finalContainUrls = [];

area.addEventListener("paste", (e) => {
  if (document.getElementById("area").value == "") {
    i = 1;
  }
  finalContainUrls = [];
  let data = e.clipboardData.getData("text");
  console.log("data in clipboard>>>>>>>>>  ", data);
  getUrls(data);
  e.preventDefault();
});
function getUrls(data) {
  let dataArr = data.split(" ");
  let mappedArr = dataArr.map((val, index) => {
    return [isValidHttpUrl(val), index];
  });

  let containsURL = [];

  mappedArr.forEach((item) => {
    if (item[0]) {
      containsURL.push(item[1]);
    }
  });

  if (containsURL.length) {
    containsURL.forEach((index) => {
      const __Str = dataArr[index].indexOf("https:" || "http:", 5);
      if (__Str === -1) {
        finalContainUrls.push(dataArr[index]);
      } else {
        checkNestedLinks(dataArr[index], __Str);
      }
    });
    console.log(
      "=========<<<<<<<<<<finalContainUrls>>>>>>>>>>=========",
      finalContainUrls
    );
  }
  if (finalContainUrls.length) {
    finalContainUrls.forEach((index) => {
      console.log("finalContainUrls index ", index);
      dataArr[index] = `${i++}. ` + index + " " + "\r\n";
      console.log("dataArr[index]<<<<>>>> ", dataArr[index]);
      area.value += dataArr[index];
    });
  }
}

const checkNestedLinks = (link, foundIndex) => {
  console.log(
    "checkNestedLinks is finalContainUrls___- ",
    finalContainUrls
  );
  const newLink = link.slice(0, foundIndex);
  finalContainUrls.push(newLink);
  const updatedLink = link.replace(newLink, "");
  const cond = updatedLink.indexOf("https:" || "http:", 5);
  console.log("updatedLink link is___- ", updatedLink);
  if (cond !== -1) {
    // finalContainUrls.push(updatedLink);
    checkNestedLinks(updatedLink, cond);
  } else {
    // checkNestedLinks(updatedLink, cond);
    const lastLink = updatedLink.slice(0, updatedLink.length);
    finalContainUrls.push(lastLink);
    return;
  }

};
function isValidHttpUrl(string) {
  let url;

  try {
    url = new URL(string);
  } catch (_) {
    return false;
  }
  return url.protocol === "http:" || url.protocol === "https:";
}

    </script>

    <!-- <script>
            $('#category').on('change', function(){
                var fd = new FormData();
                fd.append('category', $('#category').val());
                fd.append("csrfmiddlewaretoken", '{{ csrf_token }}');

                $.ajax({
                    type: "POST",
                    contentType: false,
                    processData: false,
                    url: '{% url "getCategoryLength" %}',
                    data: fd,
                    success: function success(data){
                        $('#start').attr('max', data.categoryLength-1)
                        $('#end').attr('max', data.categoryLength)
                    },
                });  
            })

            $('#start').on('change', function(){
                $('#end').attr('min', (parseInt($('#start').val())+1))
            })
        </script> -->
</body>

</html>